<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海底捞部门分类系统</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* 样式部分与之前保持一致，略 */
    </style>
</head>
<body>
    <div class="container">
        <!-- 页面内容部分 -->
        <div class="header">
            <h1>🏢 海底捞部门分类系统</h1>
            <p>基于AI的智能问题部门分类与预测平台</p>
        </div>

        <div class="nav-links">
            <a href="#">🏢 部门分类系统</a>
        </div>

        <div class="main-content">
            <!-- 上传文件区 -->
            <div class="upload-grid">
                <div class="upload-card">
                    <h3>📚 训练集上传</h3>
                    <button class="upload-btn" onclick="document.getElementById('trainInput').click()">选择训练集</button>
                    <input type="file" id="trainInput" class="file-input" accept=".xlsx,.xls" />
                </div>

                <div class="upload-card">
                    <h3>🔍 匹配库上传</h3>
                    <button class="upload-btn" onclick="document.getElementById('matchInput').click()">选择匹配库</button>
                    <input type="file" id="matchInput" class="file-input" accept=".xlsx,.xls" />
                </div>

                <div class="upload-card">
                    <h3>🔑 关键词字典上传</h3>
                    <button class="upload-btn" onclick="document.getElementById('keywordInput').click()">选择关键词文件</button>
                    <input type="file" id="keywordInput" class="file-input" accept=".py,.json" />
                </div>

                <div class="upload-card">
                    <h3>📊 待分类数据上传</h3>
                    <button class="upload-btn" onclick="document.getElementById('dataInput').click()">选择数据文件</button>
                    <input type="file" id="dataInput" class="file-input" accept=".xlsx,.xls" />
                </div>
            </div>

            <!-- 权重与随机种子设置 -->
            <div class="seed-section">
                <h3>🎲 随机种子设置</h3>
                <input type="number" id="randomSeed" value="42" />
            </div>

            <div class="weights-section">
                <h3>⚖️ 模型权重配置</h3>
                <div>
                    <label>TF-IDF 权重</label>
                    <input type="range" id="tfidfWeight" value="0.4" min="0" max="1" step="0.01" />
                    <span id="tfidfValue">0.40</span>
                </div>
                <div>
                    <label>语义相似度权重</label>
                    <input type="range" id="semanticWeight" value="0.4" min="0" max="1" step="0.01" />
                    <span id="semanticValue">0.40</span>
                </div>
                <div>
                    <label>关键词匹配权重</label>
                    <input type="range" id="keywordWeight" value="0.2" min="0" max="1" step="0.01" />
                    <span id="keywordValue">0.20</span>
                </div>
            </div>

            <div style="text-align: center;">
                <button onclick="trainModel()">🚀 训练模型</button>
                <button onclick="classifyData()">🏷️ 开始分类</button>
            </div>

            <div id="results" style="display: none;">
                <h3>分类结果</h3>
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <script>
        // 上传文件事件
        document.getElementById('trainInput').addEventListener('change', function(e) { handleFileUpload(e, 'train'); });
        document.getElementById('matchInput').addEventListener('change', function(e) { handleFileUpload(e, 'match'); });
        document.getElementById('dataInput').addEventListener('change', function(e) { handleFileUpload(e, 'data'); });
        document.getElementById('keywordInput').addEventListener('change', function(e) { handleKeywordUpload(e); });

        // 模型训练与分类处理
        function trainModel() {
            let randomSeed = document.getElementById('randomSeed').value;
            let tfidfWeight = document.getElementById('tfidfWeight').value;
            let semanticWeight = document.getElementById('semanticWeight').value;
            let keywordWeight = document.getElementById('keywordWeight').value;
            
            // 调用后端进行模型训练
            fetch("/train_model", {
                method: "POST",
                body: JSON.stringify({ randomSeed, tfidfWeight, semanticWeight, keywordWeight }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
              .then(data => {
                  document.getElementById("resultContent").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                  document.getElementById("results").style.display = 'block';
              });
        }

        function classifyData() {
            // 调用后端进行数据分类
            fetch("/classify_data", {
                method: "POST",
                body: JSON.stringify({ /* 加载待分类数据 */ }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
              .then(data => {
                  document.getElementById("resultContent").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                  document.getElementById("results").style.display = 'block';
              });
        }
    </script>
</body>
</html>
